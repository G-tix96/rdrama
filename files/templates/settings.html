{%- import 'util/macros.html' as macros with context -%}
{%- import 'html_head.html' as html_head with context -%}
<!DOCTYPE html>
<html lang="en">
<head>
	<title>{% block pagetitle %}Settings - {{SITE_NAME}}{% endblock %}</title>
</head>
{{html_head.html_head(true, false, true, none, "Settings", false)}}

<body id="settings" {% if SITE_NAME == 'rDrama' and v and (v.is_banned or v.agendaposter) %}style="overflow-x: hidden;background:url(/assets/images/backgrounds/anime/1.webp?v=3) center center fixed; background-color: var(--background)"{% elif v and v.background %}style="overflow-x: hidden;background:url(/assets/images/backgrounds/{{v.background}}?v=3) center center fixed; background-color: var(--background){% if 'anime' not in v.background %};background-size: cover{% endif %}"{% endif %}>
	{% include "header.html" %}
		<div class="container">
		<div class="row justify-content-around">
	<div class="col h-100">

		{% if error %}
		<div class="alert alert-danger alert-dismissible fade show my-3" role="alert">
			<i class="fas fa-exclamation-circle my-auto"></i>
			<span>
				{{error}}
			</span>
			<button type="button" class="close" data-bs-dismiss="alert" aria-label="Close">
				<span aria-hidden="true"><i class="far fa-times"></i></span>
			</button>
		</div>
		{% endif %}
		{% if msg %}
		<div class="alert alert-success alert-dismissible fade show my-3" role="alert">
			<i class="fas fa-check-circle my-auto" aria-hidden="true"></i>
			<span>
				{{msg}}
			</span>
			<button type="button" class="close" data-bs-dismiss="alert" aria-label="Close">
				<span aria-hidden="true"><i class="far fa-times"></i></span>
			</button>
		</div>
		{% endif %}

		<div class="mt-3">
			<h1 class="d-mob-none">Settings</h1>
			<h3 class="mt-5 d-md-none">Settings</h3>
		</div>
		<div class="flex-row bg-white box-shadow-bottom sticky d-none d-sm-flex mt-3 mb-3 mb-sm-5">
			<nav>
				<ul class="nav settings-nav">
					<li class="nav-item"><a class="nav-link{% if request.path=='/settings/personal' %} active{% endif %}" href="/settings/personal">Personal</a></li>
					<li class="nav-item"><a class="nav-link{% if request.path=='/settings/advanced' %} active{% endif %}" href="/settings/advanced">Advanced</a></li>
					<li class="nav-item"><a class="nav-link{% if request.path=='/settings/css' %} active{% endif %}" href="/settings/css">CSS</a></li>
					<li class="nav-item"><a class="nav-link{% if request.path=='/settings/security' %} active{% endif %}" href="/settings/security">Security</a></li>
					<li class="nav-item"><a class="nav-link{% if request.path=='/settings/apps' %} active{% endif %}" href="/settings/apps">Apps/Bots</a></li>
				</ul>
			</nav>
		</div>
		<div class="flex-row bg-white box-shadow-bottom sticky justify-content-center d-flex d-sm-none mt-3 mb-3 mb-sm-5">
			<nav>
				<ul class="nav settings-nav">
					<li class="nav-item"><a class="nav-link{% if request.path=='/settings/personal' %} active{% endif %} navsettings" href="/settings/personal"><i class="fas fa-cog text-base mr-0"></i></a></li>
					<li class="nav-item"><a class="nav-link{% if request.path=='/settings/advanced' %} active{% endif %} navsettings" href="/settings/advanced"><i class="fas fa-filter text-base mr-0"></i></a></li>
					<li class="nav-item"><a class="nav-link{% if request.path=='/settings/css' %} active{% endif %} navsettings" href="/settings/css"><i class="fas fa-palette text-base mr-0"></i></a></li>
					<li class="nav-item"><a class="nav-link{% if request.path=='/settings/security' %} active{% endif %} navsettings" href="/settings/security"><i class="fas fa-lock-alt text-base mr-0"></i></a></li>
					<li class="nav-item"><a class="nav-link{% if request.path=='/settings/apps' %} active{% endif %} navsettings" href="/settings/apps"><i class="fas fa-code text-base mr-0"></i></a></li>
				</ul>
			</nav>
		</div>
	{% block content %}
	{% endblock %}
	</div>
</div>

 </div>

 {% if request.path == '/settings/security' %}
		<div class="modal fade" id="2faModal" tabindex="-1" role="dialog" aria-labelledby="2faModalTitle" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">{% if mfa_secret %}Setup two-step login{% elif mfa_secret and not v.email %}Email required for two-step login{% else %}Disable two-step login{% endif %}</h5>
					<button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
						<span aria-hidden="true"><i class="far fa-times"></i></span>
					</button>
				</div>
				{% if mfa_secret %}
				<div>
					<form action="/settings/security" method="post">
						<input type="hidden" name="formkey" value="{{v|formkey}}">
						<input type="hidden" name="2fa_secret" value="{{mfa_secret}}">
						<div class="modal-body">
							<p>
								<span class="font-weight-bold">Step 1:</span> Scan this barcode (or enter the code) using a two-factor authentication app such as Google Authenticator or Authy.
							</p>
							<div class="text-center mb-3">
								<img alt="two-factor QR code" loading="lazy" class="img-fluid" width=175 src="/2faqr/{{mfa_secret}}">
								<div class="text-small text-muted mt-1">Or enter this code: {{mfa_secret}}</div>
							</div>
							<p>
								<span class="font-weight-bold">Step 2:</span> Enter the six-digit code generated in the authenticator app and your {{SITE_NAME}} account password.
							</p>
							<label for="2fa_input">6-digit code</label>
							<input autocomplete="off" type="text" class="form-control mb-2" id="2fa_input" name="2fa_token" placeholder="# # # # # #" required>

							<label for="2fa_input_password">Password</label>
							<input autocomplete="off" type="password" class="form-control mb-2" id="2fa_input_password" name="password" oninput="document.getElementById('enable2faButton').disabled=false" required>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-link text-muted" data-bs-dismiss="modal">Cancel</button>
							<input autocomplete="off" id="enable2faButton" class="btn btn-primary" type="submit" onclick="disable(this)" value="Enable 2-step login" disabled>
						</div>
					</form>
				</div>
				{% else %}
				<div>
					<form action="/settings/security" method="post">
						<input type="hidden" name="formkey" value="{{v|formkey}}">
						<input type="hidden" name="2fa_secret" value="{{mfa_secret}}">
						<div class="modal-body">

							<div class="alert alert-warning" role="alert">
								<i class="fas fa-info-circle"></i>
								To disable two-step login, please enter your {{SITE_NAME}} account password and the 6-digit code generated in your authentication app. If you no longer have your two-step device, <a href="/lost_2fa">click here</a>.
							</div>

							<label for="2fa_input_password">Password</label>
							<input autocomplete="off" type="password" class="form-control mb-2" id="2fa_input_password" name="password" required>

							<label for="2fa_input">6-digit code</label>
							<input autocomplete="off" type="text" class="form-control mb-2" id="2fa_input" name="2fa_remove" placeholder="# # # # # #" oninput="document.getElementById('disable2faButton').disabled=false" required>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-link text-muted" data-bs-dismiss="modal">Cancel</button>
							<input autocomplete="off" id="disable2faButton" class="btn btn-primary" type="submit" onclick="disable(this)" value="Disable 2-step login" disabled>
						</div>
					</form>
				</div>
				{% endif %}
			</div>
		</div>
	</div>
{% endif %}
{% block clipboard %}
<div class="toast clipboard" id="toast-success" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="true" data-bs-delay="5000">
	<div class="toast-body text-center">
		<i class="fas fa-check-circle text-success mr-2"></i>Link copied to clipboard
	</div>
</div>
{% endblock %}
<div class="toast" id="toast-post-success" style="position: fixed; bottom: 1.5rem; margin: 0 auto; left: 0; right: 0; width: 275px; z-index: 1000" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="true" data-bs-delay="5000">
	<div class="toast-body bg-success text-center text-white">
		<i class="fas fa-comment-alt-smile mr-2"></i><span id="toast-post-success-text">Action successful!</span>
	</div>
</div>
<div class="toast" id="toast-post-error" style="position: fixed; bottom: 1.5rem; margin: 0 auto; left: 0; right: 0; width: 275px; z-index: 1000" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="true" data-bs-delay="5000">
	<div class="toast-body bg-danger text-center text-white">
		<i class="fas fa-exclamation-circle mr-2"></i><span id="toast-post-error-text">Error, please try again later.</span>
	</div>
</div>
{% block onload %}{% endblock %}
<script defer src="{{'js/vendor/clipboard.js' | asset}}"></script>
</body>
</html>
